global:
  annotations:
    figment.io/github_repository: "github.com/figment-networks/ethereum-worker"
    ad.datadoghq.com/kava-worker.check_names: '["openmetrics"]'
    ad.datadoghq.com/kava-worker.init_configs: '[{}]'
    ad.datadoghq.com/kava-worker.instances: '[{
        "prometheus_url": "http://%%host%%:8087/metrics",
        "namespace": "workers",
        "metrics": ["*"],
        "send_distribution_buckets": true,
        "tags": ["network:skale","chain_id:skale","group:indexer-workers","cluster:k8s"]
      }]'
  labels:
    team: indexers
    severity: noncritical

deployments:
  ethereum-worker:
    service:
      ports:
        http:
          port: 8097
          targetPort: 8097
          protocol: TCP
    replicas: 1
    pod:
      containers:
        ethereum-worker:
          env:
            APP_ENV: production
            HOSTNAME:
              fieldRef:
                fieldPath: status.podIP
            CHAIN_ID: ethereum-worker
            MANAGERS: indexer-manager.indexers.svc.cluster.local:8085
            MANAGER_INTERVAL: 10s
            MAXIMUM_HEIGHTS_TO_GET: 10000
            REQUESTS_PER_SECOND: 33
            HEALTH_CHECK_INTERVAL: 10s
            PORT: 3000
            HTTP_PORT: 8087
          livenessProbe:
            httpGet:
              path: /liveness
              port: 8087
          readinessProbe:
            httpGet:
              path: /readiness
              port: 8087
          resources:
            requests:
              memory: 200Mi
              cpu: 500m
            limits:
              memory: 200Mi
